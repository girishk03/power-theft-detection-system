<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Power Theft Detection System - AI-Based IDS</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }

        .navbar {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 50px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .navbar h1 {
            color: #667eea;
            font-size: 1.5em;
        }

        .nav-links {
            display: flex;
            gap: 30px;
            margin-top: 10px;
        }

        .nav-links a {
            color: #666;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: #667eea;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .section {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .section h2 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 20px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .section h3 {
            color: #764ba2;
            font-size: 1.5em;
            margin: 20px 0 10px 0;
        }

        /* Home Section */
        .hero {
            text-align: center;
            padding: 60px 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
        }

        .hero h1 {
            font-size: 3em;
            margin-bottom: 20px;
        }

        .hero p {
            font-size: 1.3em;
            line-height: 1.8;
            max-width: 900px;
            margin: 0 auto;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            margin: 10px 0;
        }

        .stat-label {
            font-size: 1em;
            opacity: 0.9;
        }

        /* Lists */
        ul {
            list-style: none;
            padding-left: 0;
        }

        ul li {
            padding: 12px 0;
            padding-left: 30px;
            position: relative;
            line-height: 1.6;
        }

        ul li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #667eea;
            font-weight: bold;
            font-size: 1.2em;
        }

        /* Detection Results Table */
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            overflow-x: auto;
            display: block;
        }

        .results-table table {
            width: 100%;
            min-width: 800px;
        }

        .results-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .results-table td {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        .results-table tr:hover {
            background: #f8f9fa;
        }

        .risk-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
        }

        .risk-high {
            background: #dc3545;
            color: white;
        }

        .risk-medium {
            background: #ffc107;
            color: #333;
        }

        .risk-low {
            background: #28a745;
            color: white;
        }

        /* Workflow Steps */
        .workflow {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .workflow-step {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            border-left: 5px solid #667eea;
            transition: transform 0.3s;
        }

        .workflow-step:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .workflow-step h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .workflow-step p {
            color: #666;
            line-height: 1.6;
        }

        /* Chart Container */
        .chart-container {
            position: relative;
            height: 400px;
            margin: 30px 0;
        }

        /* Buttons */
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 10px;
            font-size: 1em;
            cursor: pointer;
            margin: 10px 5px;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        /* Methodology Grid */
        .methodology-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .methodology-card {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            border-top: 4px solid #667eea;
        }

        .methodology-card h4 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .methodology-card ul {
            margin-top: 10px;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 30px;
            background: rgba(255, 255, 255, 0.95);
            margin-top: 40px;
            border-radius: 20px;
        }

        .footer p {
            color: #666;
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <div class="navbar">
        <h1>‚ö° Power Theft Detection System</h1>
        <div class="nav-links">
            <a href="#home">Home</a>
            <a href="#problem">Problem Statement</a>
            <a href="#objectives">Objectives</a>
            <a href="#methodology">Methodology</a>
            <a href="#results">Detection Results</a>
            <a href="#visualization">Visualization</a>
            <a href="#working">How It Works</a>
            <a href="#future">Future Scope</a>
        </div>
    </div>

    <div class="container">
        <!-- Home Section -->
        <section id="home" class="hero">
            <h1>üîã Detection of Power Theft in Smart Grids</h1>
            <h2 style="margin: 20px 0;">Using AI-Based Intrusion Detection System</h2>
            <p>
                Electricity theft is a major challenge in smart grids, causing significant financial losses 
                and operational inefficiencies. Our AI-based intrusion detection system leverages deep learning 
                to accurately detect and prevent power theft in real-time, ensuring grid security and reducing 
                revenue losses for utility companies.
            </p>
            <p style="margin-top: 20px; font-size: 1.1em;">
                <strong>Purpose:</strong> To develop an intelligent system that automatically identifies 
                abnormal consumption patterns indicative of electricity theft, enabling timely intervention 
                and protecting smart grid infrastructure.
            </p>
        </section>

        <!-- Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Model Accuracy</div>
                <div class="stat-value">85%</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">AUC Score</div>
                <div class="stat-value">0.77</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total Meters</div>
                <div class="stat-value">9,957</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Flagged Cases</div>
                <div class="stat-value" id="flaggedCount">4</div>
            </div>
        </div>

        <!-- Problem Statement -->
        <section id="problem" class="section">
            <h2>üìã Problem Statement</h2>
            <p style="font-size: 1.1em; line-height: 1.8; margin-bottom: 20px;">
                Despite smart grid advancements, electricity theft remains a major challenge, causing 
                significant financial losses and operational inefficiencies. Traditional detection methods 
                struggle due to several critical challenges:
            </p>
            
            <h3>Key Challenges:</h3>
            <ul>
                <li><strong>Missing or Incomplete Data:</strong> Smart meters may fail or lose connection, 
                    resulting in gaps in consumption records that traditional systems cannot handle.</li>
                <li><strong>Imbalanced Datasets:</strong> Theft cases represent only 10-15% of total data, 
                    causing models to be biased toward normal consumption patterns.</li>
                <li><strong>Unpredictable Consumption Behavior:</strong> Electricity usage varies by season, 
                    time of day, and user behavior, making simple rule-based detection ineffective.</li>
                <li><strong>Complex Theft Patterns:</strong> Thieves employ sophisticated methods like meter 
                    tampering, bypassing, and gradual consumption reduction that are difficult to detect.</li>
                <li><strong>High False Positive Rates:</strong> Traditional methods generate numerous false 
                    alarms, wasting resources on unnecessary investigations.</li>
            </ul>

            <p style="font-size: 1.1em; margin-top: 20px; padding: 20px; background: #f8f9fa; border-left: 4px solid #667eea; border-radius: 10px;">
                <strong>Need:</strong> There is a pressing need for an intelligent AI-based system that can 
                accurately detect and prevent power theft in real-time, handling missing data, class imbalance, 
                and complex consumption patterns effectively.
            </p>
        </section>

        <!-- Objectives -->
        <section id="objectives" class="section">
            <h2>üéØ Objectives</h2>
            <p style="font-size: 1.1em; margin-bottom: 20px;">
                Our project aims to achieve the following key goals:
            </p>
            <ul>
                <li><strong>Improve Detection Accuracy:</strong> Achieve 85%+ accuracy in identifying 
                    electricity theft cases using advanced machine learning algorithms.</li>
                <li><strong>Reduce False Positives:</strong> Minimize unnecessary investigations by 
                    accurately distinguishing between normal consumption variations and actual theft.</li>
                <li><strong>Enable Timely Automated Responses:</strong> Provide real-time detection and 
                    automated alert generation for immediate action by utility operators.</li>
                <li><strong>Handle Missing Data:</strong> Implement robust preprocessing techniques to 
                    maintain system performance even with incomplete meter readings.</li>
                <li><strong>Address Class Imbalance:</strong> Use SMOTE and other techniques to ensure 
                    the model learns theft patterns effectively despite limited theft cases.</li>
                <li><strong>Capture Complex Patterns:</strong> Leverage deep learning (CNN, LSTM) to 
                    identify sophisticated theft techniques and irregular consumption behaviors.</li>
                <li><strong>Provide Actionable Insights:</strong> Generate detailed reports with 
                    consumption visualizations and risk assessments for each flagged meter.</li>
                <li><strong>Ensure Scalability:</strong> Design a system capable of monitoring thousands 
                    of meters simultaneously in real-time.</li>
            </ul>
        </section>

        <!-- Methodology -->
        <section id="methodology" class="section">
            <h2>üî¨ Methodology</h2>
            <p style="font-size: 1.1em; margin-bottom: 30px;">
                Our approach combines advanced data preprocessing, feature engineering, and deep learning 
                to create a robust theft detection system:
            </p>

            <div class="methodology-grid">
                <div class="methodology-card">
                    <h4>1. Data Collection</h4>
                    <ul>
                        <li>Smart meter consumption data (365 days)</li>
                        <li>Real Kaggle dataset (9,957 customers)</li>
                        <li>Daily kWh readings</li>
                        <li>Labeled theft cases (15% of data)</li>
                    </ul>
                </div>

                <div class="methodology-card">
                    <h4>2. Data Preprocessing</h4>
                    <ul>
                        <li>Missing value imputation (fillna)</li>
                        <li>Data normalization (StandardScaler)</li>
                        <li>SMOTE for class balancing</li>
                        <li>Outlier detection and handling</li>
                    </ul>
                </div>

                <div class="methodology-card">
                    <h4>3. Feature Engineering</h4>
                    <ul>
                        <li>Statistical features (mean, std, max, min)</li>
                        <li>Time-series patterns</li>
                        <li>Frequency domain features</li>
                        <li>Consumption trend analysis</li>
                    </ul>
                </div>

                <div class="methodology-card">
                    <h4>4. Deep Learning Models</h4>
                    <ul>
                        <li>Random Forest (50 trees)</li>
                        <li>CNN for pattern recognition</li>
                        <li>LSTM for temporal dependencies</li>
                        <li>Ensemble methods</li>
                    </ul>
                </div>

                <div class="methodology-card">
                    <h4>5. Model Training</h4>
                    <ul>
                        <li>80-20 train-test split</li>
                        <li>Cross-validation</li>
                        <li>Hyperparameter tuning</li>
                        <li>Performance optimization</li>
                    </ul>
                </div>

                <div class="methodology-card">
                    <h4>6. Evaluation Metrics</h4>
                    <ul>
                        <li>Accuracy: 85%</li>
                        <li>AUC Score: 0.77</li>
                        <li>Precision and Recall</li>
                        <li>Confusion Matrix</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Detection Results -->
        <section id="results" class="section">
            <h2>üö® Detection Results</h2>
            <p style="font-size: 1.1em; margin-bottom: 20px;">
                The following meters have been flagged for potential electricity theft based on AI analysis:
            </p>

            <div class="results-table">
                <table id="resultsTable">
                    <thead>
                        <tr>
                            <th>Meter ID</th>
                            <th>Customer</th>
                            <th>Location</th>
                            <th>Theft Probability</th>
                            <th>Risk Level</th>
                            <th>Avg Consumption</th>
                            <th>Expected</th>
                            <th>Anomaly Type</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Visualization -->
        <section id="visualization" class="section">
            <h2>üìä Consumption Visualization</h2>
            <p style="font-size: 1.1em; margin-bottom: 20px;">
                Graphical representation of consumption data with detected anomalies highlighted:
            </p>
            
            <div style="margin: 20px 0;">
                <label for="meterSelect" style="font-weight: bold; margin-right: 10px;">Select Meter:</label>
                <select id="meterSelect" style="padding: 10px; border-radius: 5px; border: 1px solid #ddd;">
                    <option value="MTR-8546920">MTR-8546920 (High Risk)</option>
                    <option value="MTR-6177183">MTR-6177183 (High Risk)</option>
                    <option value="MTR-7222500">MTR-7222500 (Medium Risk)</option>
                    <option value="MTR-7134080">MTR-7134080 (Medium Risk)</option>
                </select>
                <button class="btn" onclick="loadConsumptionChart()">Load Chart</button>
            </div>

            <div class="chart-container">
                <canvas id="consumptionChart"></canvas>
            </div>

            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-top: 20px;">
                <h4 style="color: #667eea; margin-bottom: 10px;">Chart Legend:</h4>
                <ul style="list-style: none;">
                    <li style="padding: 5px 0;"><span style="color: #4CAF50; font-weight: bold;">‚óè</span> Normal Consumption Pattern</li>
                    <li style="padding: 5px 0;"><span style="color: #f44336; font-weight: bold;">‚óè</span> Detected Theft/Anomaly</li>
                    <li style="padding: 5px 0;"><span style="color: #FF9800; font-weight: bold;">‚Äî</span> Threshold Line</li>
                </ul>
            </div>
        </section>

        <!-- How It Works -->
        <section id="working" class="section">
            <h2>‚öôÔ∏è How the System Works</h2>
            <p style="font-size: 1.1em; margin-bottom: 30px;">
                Our AI-based power theft detection system follows a comprehensive workflow:
            </p>

            <div class="workflow">
                <div class="workflow-step">
                    <h4>Step 1: Data Collection</h4>
                    <p>The system continuously collects electricity consumption data from smart meters 
                       deployed across the smart grid network. Data includes daily kWh readings, timestamps, 
                       and meter identifiers.</p>
                </div>

                <div class="workflow-step">
                    <h4>Step 2: Preprocessing</h4>
                    <p>Data preprocessing is performed including cleaning, normalization, and handling 
                       missing or imbalanced data using techniques like interpolation and SMOTE to ensure 
                       robust model training.</p>
                </div>

                <div class="workflow-step">
                    <h4>Step 3: Feature Engineering</h4>
                    <p>Meaningful time-series and frequency features are extracted from consumption patterns, 
                       including statistical measures (mean, std, max, min) and temporal dependencies.</p>
                </div>

                <div class="workflow-step">
                    <h4>Step 4: Model Training</h4>
                    <p>Deep learning models (CNN, LSTM, Random Forest) are trained on historical labeled 
                       data to learn to distinguish between normal consumption and theft patterns with 
                       high accuracy.</p>
                </div>

                <div class="workflow-step">
                    <h4>Step 5: Real-Time Detection</h4>
                    <p>Once deployed, the model analyzes incoming consumption data in real-time to detect 
                       anomalies indicative of theft or intrusion, processing predictions in under 1 second.</p>
                </div>

                <div class="workflow-step">
                    <h4>Step 6: Alert Generation</h4>
                    <p>The system generates automated alerts for suspected theft cases, which are displayed 
                       on the interface along with consumption visualizations and risk assessments.</p>
                </div>

                <div class="workflow-step">
                    <h4>Step 7: Operator Review</h4>
                    <p>Utility operators can review flagged meters, monitor grid health, analyze consumption 
                       patterns, and take necessary investigative or corrective action.</p>
                </div>

                <div class="workflow-step">
                    <h4>Step 8: Continuous Improvement</h4>
                    <p>The system continuously improves with retraining as new data becomes available, 
                       adapting to emerging theft patterns and improving detection accuracy over time.</p>
                </div>
            </div>
        </section>

        <!-- Future Scope -->
        <section id="future" class="section">
            <h2>üöÄ Future Scope</h2>
            <p style="font-size: 1.1em; margin-bottom: 20px;">
                Potential enhancements and expansions for the system:
            </p>
            <ul>
                <li><strong>Integration with IoT Devices:</strong> Connect with additional smart grid sensors 
                    for comprehensive monitoring including voltage, current, and power factor analysis.</li>
                <li><strong>Mobile Application:</strong> Develop mobile apps for utility operators to receive 
                    real-time alerts and manage investigations on-the-go.</li>
                <li><strong>Advanced Deep Learning:</strong> Implement transformer models and attention mechanisms 
                    for improved pattern recognition and anomaly detection.</li>
                <li><strong>Predictive Analytics:</strong> Forecast potential theft cases before they occur 
                    based on early warning indicators and behavioral patterns.</li>
                <li><strong>Geographic Information System (GIS):</strong> Integrate GIS mapping to visualize 
                    theft hotspots and identify regional patterns.</li>
                <li><strong>Blockchain Integration:</strong> Use blockchain for tamper-proof logging of 
                    consumption data and investigation records.</li>
                <li><strong>Multi-Utility Support:</strong> Extend the system to detect theft in water and 
                    gas utilities using similar AI techniques.</li>
                <li><strong>Automated Response System:</strong> Implement automated meter disconnection or 
                    load limiting for confirmed theft cases.</li>
                <li><strong>Customer Portal:</strong> Provide customers with consumption insights and 
                    anomaly notifications to encourage self-reporting.</li>
                <li><strong>Federated Learning:</strong> Enable collaborative learning across multiple 
                    utility companies while preserving data privacy.</li>
            </ul>
        </section>

        <!-- Footer -->
        <div class="footer">
            <h3 style="color: #667eea; margin-bottom: 15px;">Power Theft Detection System</h3>
            <p><strong>Project:</strong> Detection of Power Theft in Smart Grids Using AI-Based IDS</p>
            <p><strong>Institution:</strong> Anurag University</p>
            <p><strong>Technology:</strong> Python, TensorFlow, Flask, Machine Learning</p>
            <p style="margin-top: 15px; color: #999;">¬© 2025 - All Rights Reserved</p>
        </div>
    </div>

    <script>
        let consumptionChart = null;

        // Load detection results
        async function loadDetectionResults() {
            try {
                const response = await fetch('/api/detection-results');
                const results = await response.json();
                
                const tbody = document.querySelector('#resultsTable tbody');
                tbody.innerHTML = '';
                
                results.forEach(result => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td><strong>${result.meter_id}</strong></td>
                        <td>${result.customer_name}</td>
                        <td>${result.location}</td>
                        <td><strong>${(result.theft_probability * 100).toFixed(1)}%</strong></td>
                        <td><span class="risk-badge risk-${result.risk_level.toLowerCase()}">${result.risk_level}</span></td>
                        <td>${result.avg_consumption} kWh</td>
                        <td>${result.expected_consumption} kWh</td>
                        <td>${result.anomaly_type}</td>
                        <td>${result.status}</td>
                        <td><button class="btn" style="padding: 5px 15px; font-size: 0.9em;" onclick="viewDetails('${result.meter_id}')">View</button></td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading results:', error);
            }
        }

        // Load consumption chart
        async function loadConsumptionChart() {
            const meterId = document.getElementById('meterSelect').value;
            
            try {
                const response = await fetch(`/api/consumption-data/${meterId}`);
                const data = await response.json();
                
                const ctx = document.getElementById('consumptionChart').getContext('2d');
                
                if (consumptionChart) {
                    consumptionChart.destroy();
                }
                
                // Create datasets
                const normalData = data.consumption.map((val, idx) => 
                    idx < data.anomaly_start ? val : null
                );
                const theftData = data.consumption.map((val, idx) => 
                    idx >= data.anomaly_start ? val : null
                );
                
                consumptionChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: data.days,
                        datasets: [
                            {
                                label: 'Normal Consumption',
                                data: normalData,
                                borderColor: '#4CAF50',
                                backgroundColor: 'rgba(76, 175, 80, 0.1)',
                                borderWidth: 2,
                                pointRadius: 0,
                                tension: 0.4
                            },
                            {
                                label: 'Detected Theft',
                                data: theftData,
                                borderColor: '#f44336',
                                backgroundColor: 'rgba(244, 67, 54, 0.1)',
                                borderWidth: 2,
                                pointRadius: 0,
                                tension: 0.4
                            },
                            {
                                label: 'Threshold',
                                data: Array(365).fill(data.threshold),
                                borderColor: '#FF9800',
                                borderWidth: 2,
                                borderDash: [5, 5],
                                pointRadius: 0,
                                fill: false
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: `Consumption Pattern - ${meterId}`,
                                font: { size: 16, weight: 'bold' }
                            },
                            legend: {
                                display: true,
                                position: 'top'
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'Days (2015)'
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'Consumption (kWh)'
                                },
                                beginAtZero: true
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('Error loading chart:', error);
            }
        }

        function viewDetails(meterId) {
            document.getElementById('meterSelect').value = meterId;
            loadConsumptionChart();
            document.getElementById('visualization').scrollIntoView({ behavior: 'smooth' });
        }

        // Load data on page load
        window.addEventListener('load', () => {
            loadDetectionResults();
            loadConsumptionChart();
        });
    </script>
</body>
</html>
